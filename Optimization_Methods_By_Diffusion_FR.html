<!DOCTYPE html>
<html lang="fr" data-theme="light">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>méthodes d'optimisation classées</title>

  <!-- MathJax CSP-safe : tex-html.js (sans eval), AMS pour symboles -->
<script>
  window.MathJax = {
    tex: {
      inlineMath: [['\\(','\\)'], ['\\[','\\]']],
      displayMath: [['\\[','\\]']],
      processEscapes: true,
      packages: {'[+]': ['ams']}  // AMS synchrone pour \nabla, etc.
    },
    startup: {
      pageReady() {
        return MathJax.startup.defaultPageReady().then(() => {
          // Re-rendu après typesetting initial pour intégration parfaite
          if (typeof initTable === 'function') {
            initTable();
          }
        });
      }
    }
  };
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-html.js" id="MathJax-script" async></script>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    :root {
      --bg-primary:#f7f9fc; --bg-secondary:#ffffff; --bg-tertiary:#eef2f8;
      --text-primary:#141a2a; --text-secondary:#4b5568;
      --accent-primary:#0b66ff; --accent-secondary:#7a3ff2;
      --accent-gradient:linear-gradient(135deg,#0b66ff 0%,#7a3ff2 100%);
      --border-color:#d9e1f2;
      --shadow:0 8px 24px rgba(11,102,255,.08);
      --hover-shadow:0 12px 36px rgba(11,102,255,.12);
    }
    [data-theme="dark"] {
      --bg-primary:#0a0e27; --bg-secondary:#151932; --bg-tertiary:#1e2139;
      --text-primary:#e4e7f5; --text-secondary:#a0a6c9;
      --accent-primary:#00d4ff; --accent-secondary:#7b2ff7;
      --accent-gradient:linear-gradient(135deg,#00d4ff 0%,#7b2ff7 100%);
      --border-color:#20304d;
      --shadow:0 8px 32px rgba(0,212,255,.10);
      --hover-shadow:0 12px 48px rgba(0,212,255,.18);
    }
    html, body { width:100%; height:100%; }
    body {
      font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:var(--bg-primary); color:var(--text-primary); line-height:1.6;
    }

    .theme-toggle {
      position:fixed; top:14px; right:14px; z-index:1000;
      display:inline-flex; align-items:center; gap:10px;
      padding:6px 10px; border-radius:999px;
      background:var(--bg-secondary); color:var(--text-primary);
      border:1px solid var(--border-color);
      box-shadow:var(--shadow);
    }
    .toggle {
      --w:46px; --h:26px;
      position:relative; width:var(--w); height:var(--h);
      border-radius:var(--h); background:#c9d3ea; transition:.2s;
      border:1px solid var(--border-color); cursor:pointer;
      flex-shrink:0;
    }
    .toggle::after {
      content:''; position:absolute; top:2px; left:2px;
      width:22px; height:22px; border-radius:50%;
      background:#fff; box-shadow:0 2px 6px rgba(0,0,0,.15);
      transition:transform .2s ease;
    }
    .toggle[aria-pressed="true"] { background:#7a3ff2; }
    .toggle[aria-pressed="true"]::after { transform:translateX(20px); }
    .toggle-label { font-size:.9rem; color:var(--text-secondary); }

    .container { width:100%; padding:16px; }

    .header {
      width:100%; background:var(--bg-secondary); border-radius:16px;
      padding:28px 16px; margin:56px 0 16px; box-shadow:var(--shadow);
      position:relative; text-align:center;
    }
    .header::before { content:''; position:absolute; top:0; left:0; right:0; height:4px; background:var(--accent-gradient); }
    .title {
      font-size:2rem; font-weight:800; margin-bottom:6px;
      background:var(--accent-gradient); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text;
    }
    .subtitle { color:var(--text-secondary); font-size:1.02rem; }

    .tools {
      width:100%; display:flex; gap:10px; align-items:center; justify-content:space-between;
      margin:12px 0 10px;
    }
    .search-input {
      flex:1 1 auto; background:var(--bg-secondary); color:var(--text-primary);
      border:1px solid var(--border-color); border-radius:12px;
      padding:10px 12px; outline:none;
    }
    .clear-btn {
      background:transparent; color:var(--accent-primary);
      border:1px solid var(--border-color); padding:10px 12px;
      border-radius:12px; cursor:pointer; white-space:nowrap;
    }
    .clear-btn:hover { border-color:var(--accent-primary); }

    .table-wrapper {
      width:100%; background:var(--bg-secondary);
      border-radius:16px; box-shadow:var(--shadow);
      overflow:hidden;
    }
    table { width:100%; border-collapse:separate; border-spacing:0; table-layout:fixed; }
    thead { position:sticky; top:0; background:var(--accent-gradient); z-index:2; }
    thead th {
      padding:14px 10px; text-align:left; font-weight:700; font-size:.9rem;
      color:#fff; text-transform:uppercase; letter-spacing:.4px; cursor:pointer; user-select:none;
      border-bottom:3px solid rgba(255,255,255,.25);
    }
    thead th .arrow { margin-left:6px; opacity:.9; font-size:.85rem; }
    thead th.sort-asc .arrow::after { content:"▲"; }
    thead th.sort-desc .arrow::after { content:"▼"; }

    tbody tr { background:var(--bg-secondary); transition:background .15s ease; }
    tbody tr:nth-child(even) { background:var(--bg-tertiary); }
    tbody tr:hover { background:var(--bg-primary); }
    .MathJax { display: inline-block; }
    .MathJax .merror { color: red; background: yellow; }
    td {
      padding:12px; border-bottom:1px solid var(--border-color);
      font-size:.92rem; color:var(--text-primary); vertical-align:top;
      word-break:break-word; overflow-wrap:anywhere; white-space:normal;
      max-width: 0; overflow-wrap: break-word;
    }
    td.index { width:52px; text-align:right; color:#8a94b5; font-weight:700; }
    td.method { color:var(--accent-primary); font-weight:600; }

    .tex-inline {
      display:inline; white-space:normal; word-break:break-word; overflow-wrap:anywhere;
    }
    .tex-inline.long { display:block; }

    .badge { display:inline-block; padding:4px 10px; border-radius:16px; font-size:.72rem; font-weight:700; text-transform:uppercase; letter-spacing:.4px; }
    .low{background:rgba(46,213,115,.16); color:#1f9d63;}
    .med{background:rgba(255,159,67,.16); color:#c06a18;}
    .high{background:rgba(238,82,83,.16); color:#b53a3b;}
    .lin{background:rgba(52,172,224,.16); color:#1f7ea1;}
    .sup{background:rgba(123,47,247,.16); color:#5a2cbb;}
    .quad{background:rgba(0,212,255,.16); color:#0b7b8a;}

    a { color:var(--accent-primary); text-decoration:none; }
    a:hover { color:var(--accent-secondary); }

    .footer {
      width:100%; background:var(--bg-secondary); border-radius:16px; box-shadow:var(--shadow);
      margin:16px 0 24px; padding:18px; text-align:center; color:var(--text-secondary);
    }

    @media (max-width: 900px) {
      .title { font-size:1.6rem; }
      thead th, td { padding:10px 8px; font-size:.86rem; }
      .theme-toggle { gap:8px; padding:6px 8px; }
    }
  </style>
</head>
<body>
  <div class="theme-toggle" aria-live="polite">
    <button id="toggleBtn" class="toggle" aria-pressed="false" aria-label="Basculer clair/sombre"></button>
    <span id="toggleText" class="toggle-label">Light</span>
  </div>

  <div class="container">
    <header class="header">
      <h1 class="title">méthodes d'optimisation classées</h1>
      <p class="subtitle">Tri par colonne, recherche, numérotation, rendu TeX, thème clair/sombre</p>
    </header>

    <section class="tools">
      <input id="searchBox" class="search-input" type="search" placeholder="Rechercher une méthode, nature, diffusion, formule…"/>
      <button class="clear-btn" onclick="clearSearch()">Effacer</button>
      <div style="color:var(--text-secondary); font-size:.9rem;">Cliquer un en‑tête pour trier ▲▼</div>
    </section>

    <section class="table-wrapper">
      <table id="methodsTable">
        <thead>
          <tr>
            <th data-key="index"># <span class="arrow"></span></th>
            <th data-key="method">Méthode <span class="arrow"></span></th>
            <th data-key="formula">Formule (TeX) <span class="arrow"></span></th>
            <th data-key="memory">Memory <span class="arrow"></span></th>
            <th data-key="conv">Convergence <span class="arrow"></span></th>
            <th data-key="deriv">Dérivé <span class="arrow"></span></th>
            <th data-key="cond">Conditionnement <span class="arrow"></span></th>
            <th data-key="diff">Diffusion <span class="arrow"></span></th>
            <th data-key="diffFormula">Formule Diffusion (TeX) <span class="arrow"></span></th>
            <th data-key="nature">Nature <span class="arrow"></span></th>
            <th data-key="desc">Description <span class="arrow"></span></th>
            <th data-key="link">Lien <span class="arrow"></span></th>
          </tr>
        </thead>
        <tbody id="tableBody"><!-- rendu JS --></tbody>
      </table>
    </section>

    <footer class="footer">
      © 2025 thibaut LOMBARD — <a href="https://github.com/Lombard-Web-Services/Docs/" target="_blank" rel="noopener">https://github.com/Lombard-Web-Services/Docs/</a>
    </footer>
  </div>

  <script>
    // Données et fonctions définies en amont pour indépendance
    function escapeHTML(x){ return String(x).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }
    function badgeMemory(s){
      if(s.startsWith('Low')) return `<span class="badge low">${s}</span>`;
      if(s.startsWith('Medium')) return `<span class="badge med">${s}</span>`;
      return `<span class="badge high">${s}</span>`;
    }
    function badgeConv(s){
      if(s.startsWith('Linear')) return `<span class="badge lin">${s}</span>`;
      if(s.startsWith('Superlinear')) return `<span class="badge sup">${s}</span>`;
      return `<span class="badge quad">${s}</span>`;
    }
    function texSpan(texString, useMathJax = true){
      const long = texString.length > 80 ? ' long' : '';
      if (useMathJax) {
        return `<span class="tex-inline${long}">\( ${texString} \)</span>`;
      } else {
        return `<span class="tex-inline${long}">${escapeHTML(texString)}</span>`;  // Texte brut si pas de MathJax
      }
    }

    const dataRows = [
      {
        "method": "Gradient Descent",
        "formula": "x_{k+1} = x_k - \\alpha \\nabla f(x_k)",
        "memory": "Low O(n)",
        "conv": "Linear",
        "deriv": "1st Order",
        "cond": "Poor (ill-cond.)",
        "diff": "Locale linéaire",
        "diffFormula": "\\Delta f = \\nabla \\cdot (\\nabla f)",
        "nature": "Isotrope",
        "desc": "Descente de gradient classique.",
        "link": "https://en.wikipedia.org/wiki/Gradient_descent"
      },
      {
        "method": "Optimal Transport (Wasserstein)",
        "formula": "W_2^2(p,q) = \\inf_{\\pi \\in \\Pi(p,q)} \\int \\|x - y\\|^2 \\, d\\pi(x,y)",
        "memory": "High O(n^3)",
        "conv": "Superlinear",
        "deriv": "Implicit Gradient",
        "cond": "Excellent (géométrie lisse)",
        "diff": "Géométrique",
        "diffFormula": "\\Delta_W f = \\mathrm{div}_W (\\nabla_W f)",
        "nature": "Wasserstein",
        "desc": "Optimisation sur l’espace des mesures.",
        "link": "https://en.wikipedia.org/wiki/Wasserstein_metric"
      },
      {
        "method": "Improving Stochastic Cubic Newton Momentum",
        "formula": "x_{k+1} = x_k - (H^{1/3} + \\mathrm{momentum}) \\nabla f",
        "memory": "Medium O(n^2)",
        "conv": "Superlinear",
        "deriv": "2nd Order",
        "cond": "Stable (improving)",
        "diff": "Amélioration cubic Newton stochastique momentum.",
        "diffFormula": "\\Delta_{ISCN} f = H^{1/3} \\operatorname{Tr}(m)",
        "nature": "Diffusion improving cubic — Propagation second-order methods.",
        "desc": "Amélioration de Newton cubique stochastique avec momentum.",
        "link": "https://arxiv.org/pdf/1912.04456.pdf"
      }
    ];

    function initTable() {
      const tbody = document.getElementById('tableBody');
      if (!tbody) return;  // Sécurité si DOM pas prêt

      const thead = document.querySelector('thead');
      const searchBox = document.getElementById('searchBox');

      let sortState = { key:'index', dir:'asc' };
      let view = dataRows.map((r,i)=>({...r, index:i+1}));
      const hasMathJax = typeof window.MathJax !== 'undefined' && MathJax.typesetPromise;

      function rowHTML(r){
        return `
          <tr>
            <td class="index">${r.index}</td>
            <td class="method">${escapeHTML(r.method)}</td>
            <td>${texSpan(r.formula, hasMathJax)}</td>
            <td>${badgeMemory(r.memory)}</td>
            <td>${badgeConv(r.conv)}</td>
            <td>${escapeHTML(r.deriv)}</td>
            <td>${escapeHTML(r.cond)}</td>
            <td>${escapeHTML(r.diff)}</td>
            <td>${texSpan(r.diffFormula, hasMathJax)}</td>
            <td>${escapeHTML(r.nature)}</td>
            <td>${escapeHTML(r.desc)}</td>
            <td><a href="${r.link}" target="_blank" rel="noopener">Lien</a></td>
          </tr>
        `;
      }

      async function render(){
        tbody.innerHTML = view.map(rowHTML).join('');
        if (hasMathJax) {
          try {
            MathJax.typesetClear([tbody]);
            await MathJax.typesetPromise([tbody]);
          } catch (e) {
            console.warn('MathJax re-rendu échoué :', e);  // Ne bloque pas l'affichage
          }
        }
      }

      function normalizeForSort(val){
        const s = (val??'').toString().toLowerCase();
        const n = parseFloat(s.replace(/[^\d.+-eE]/g,''));
        return Number.isFinite(n) && /[\d]/.test(s) ? n : s;
      }

      function sortBy(key){
        if (!thead) return;
        thead.querySelectorAll('th').forEach(th=>th.classList.remove('sort-asc','sort-desc'));
        if (sortState.key===key) sortState.dir = (sortState.dir==='asc')?'desc':'asc';
        else { sortState.key=key; sortState.dir='asc'; }
        view.sort((a,b)=>{
          const va = normalizeForSort(a[key]);
          const vb = normalizeForSort(b[key]);
          if (typeof va === 'number' && typeof vb === 'number') return va - vb;
          return String(va).localeCompare(String(vb),'fr',{numeric:true,sensitivity:'base'});
        });
        if (sortState.dir==='desc') view.reverse();
        view.forEach((r,i)=>r.index=i+1);
        const th = thead.querySelector(`th[data-key="${key}"]`);
        if (th) th.classList.add(sortState.dir==='asc'?'sort-asc':'sort-desc');
        render();
      }
      if (thead) {
        thead.querySelectorAll('th').forEach(th=>{
          th.addEventListener('click',()=>sortBy(th.dataset.key));
        });
      }

      function applySearch(){
        if (!searchBox) return;
        const q = searchBox.value.trim().toLowerCase();
        const src = dataRows.map((r,i)=>({...r,index:i+1}));
        view = !q ? src : src.filter(r => Object.values(r).some(v => String(v).toLowerCase().includes(q)));
        view.sort((a,b)=>{
          const va = normalizeForSort(a[sortState.key]);
          const vb = normalizeForSort(b[sortState.key]);
          if (typeof va === 'number' && typeof vb === 'number') return va - vb;
          return String(va).localeCompare(String(vb),'fr',{numeric:true,sensitivity:'base'});
        });
        if (sortState.dir==='desc') view.reverse();
        view.forEach((r,i)=>r.index=i+1);
        render();
      }
      function clearSearch(){ 
        if (searchBox) searchBox.value=''; 
        applySearch(); 
      }
      window.clearSearch = clearSearch;
      if (searchBox) {
        searchBox.addEventListener('input', applySearch);
      }

      // Rendu initial immédiat
      sortBy('index');
    }

    // Thème toggle (indépendant)
    const htmlEl = document.documentElement;
    const btn = document.getElementById('toggleBtn');
    const txt = document.getElementById('toggleText');
    if (btn && txt) {
      btn.addEventListener('click', ()=>{
        const toDark = htmlEl.getAttribute('data-theme') === 'light';
        htmlEl.setAttribute('data-theme', toDark ? 'dark' : 'light');
        btn.setAttribute('aria-pressed', String(toDark));
        txt.textContent = toDark ? 'Dark' : 'Light';
      });
    }

    // Initialisation sur DOM prêt (garantit affichage des rows)
    document.addEventListener('DOMContentLoaded', () => {
      initTable();
    });
  </script>
</body>
</html>
